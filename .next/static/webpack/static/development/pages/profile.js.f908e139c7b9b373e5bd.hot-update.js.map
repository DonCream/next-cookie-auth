{"version":3,"file":"static/webpack/static/development/pages/profile.js.f908e139c7b9b373e5bd.hot-update.js","sources":["webpack:///./lib/auth.jsx"],"sourcesContent":["import axios from \"axios\";\nimport Router from 'next/router';\n\n\naxios.defaults.withCredentials = true;\n\nexport const getServerSideToken = req => {\n const {signedCookies = {} } = req;\n\n if(!signedCookies) {\n  return {};\n } else if (!signedCookies.token) {\n  return {};\n }\n return { user: signedCookies.token}\n};\n\nexport const getClientSideToken = () => {\n if(typeof window !== 'undefined') {\n  const user = window[WINDOW_USER_SCRIPT_VARIABLE] || {};\n  return {user};\n }\n return {user: {}}\n}\n\nconst WINDOW_USER_SCRIPT_VARIABLE = '__USER__';\n\nexport const getUserScript = user => {\n return `${WINDOW_USER_SCRIPT_VARIABLE} = ${JSON.stringify(user)};`;\n}\n\nexport const authInitialProps = isProtectedRoute => ({req, res}) => {\n const auth = req ? getServerSideToken(req) : getClientSideToken(); \n const currentPath = req ? req.url : window.location.pathname;\n const user = auth.user;\n const isAnonymous = !user || user.type !== 'authenticated';\n  if(isProtectedRoute && isAnonymous && currentPath !== '/login') {\n   return redirectUser(res,'/login');\n  }\n \n return {auth};\n};\n\nconst redirectUser = (res, path) => {\n if (res) {\n  res.redirect(302, path);\n  res.finished = true;\n  return {};\n }\n Router.replace(path)\n}\n\nexport const loginUser = async (email, password) => {\n  const { data } = await axios.post(\"/api/login\", { email, password });\n  if(typeof window !== 'undefined') {\n   window[WINDOW_USER_SCRIPT_VARIABLE] = data || {};\n  }\n};\n\nexport const logoutUser = async () => {\n if (typeof window !== 'undefined') {\n  window[WINDOW_USER_SCRIPT_VARIABLE] = {};\n }\n  await axios.post('/api/logout');\n  Router.push('/login');\n}\n\nexport const getUserProfile = async () => {\n  const { data } = await axios.get(\"/api/profile\");\n  return data;\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAGA;AAEA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAVA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAFA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;AACA;AADA;AAKA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;;;;A","sourceRoot":""}